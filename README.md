# Шашки с Искусственным интеллектом на Rust, Bevy и Python или DigiДухЛесс

![Шашка](https://i.ibb.co/WDxxKJD/Screenshot-2022-01-13-140430.png)

## Пролог

**2022**

Проторчав два года в тюрьме, и растеряв, но не до конца навыки программирования, первым делом, сразу как вышел я подумал: "а могу ли я еще". Вернее, моей мотивацией было проверить, остались ли у меня мозги, и, судя по ощущениям, попытать реанимировать то что осталось.

Конечно, я написал много кода, и хотя мне уже 32, начал программировать я в 13 -- 19 лет даром не проходят. По правде говоря, я не очень то умею что-то еще помимо, ну разве что чуть-чуть шить и кроить. Хм, наверное два года не много, чтобы растерять навык, а с другой стороны, может быть и хорошая отправная точка, чтобы заняться чем-то новым.

**2006-2008**

Конечно, программировать CRUD-ы, веб-интерфейсы и веб я умею, и когда то, что являлось ремеслом, которое помогало заработать карманные деньги превратилось в основную профессию. Это несколько угнетало, потому что моя специализация -- искуственный интеллект (ИИ), а не сайты, веб-приложение или приложухи. Но когда кишка побеждает разум, особенно в начале карьеры, не особенно задумываешься о выбранном пути, тем более что работы много и за нее платят. Так началась моя карьера.

Первая работа была совсем уж рутинной, но я купил себе Иксбокс, Нинтенду, ноутбук и съездил на море. Совмещать с учебой было сложно, но карманные деньги в то время, на первом курсе института, открывали все двери. Главные двери, конечно, находились в трусиках у девушек.

**2008-2910**

Прошел кризис 2008 года, а вместе с ним закончилась и работа для строителя Интернета. На самом, работа-то осталась, но к тому времени я прошел замечательный курс математического моделирования, в котором были дифференциальные уравнения, численные методы их решения, статистика, случайные процессы и много всего интересного. После экскурса во взрослый мир вычислений, бунтарский мир строителя Интернета потерял свои краски, но этому способствовал и кризис, который хлопнул быстро надвующийся пузырь. Тогда программирование стало для меня чем-то большим, чем ремеслом, чтобы купить пельмени в Пятерочке, видеоигру или сходить на свидание с девушкой с сайта знакомств. Конечно, за интересное не платили, и я продолжал работать в Вебе. 

**2010**

Пузырь снова надулся, Интернет стал казаться полным возможностей, за океаном гремела Кремниевая  Долине, стартапы делали очень много новостей, появился Фейсбук и Вконтакте, а Веб-Девелоперы стали новыми рок-звездами. 

По мере надувания пузыря росли эго и зарплаты веб-девелоперов, и наш мир в какой-то момент стал привлекать девченок, венчурные инвестиции, кутеж. В один момент это было что-то вроде Духлесс Минаева, воздух был каким-то особенным, а девченки особенно красивыми.

**2011**

Хм, а настоящие звезды, или те кто делает что-то для звезд, для космоса и неба, computer scietists, оставались в тени. Наверное именно тогда, в эпоху Интернет-бума, мало-грамотные кодеры, юные герои веба могли ощущать некоторую ответсвенность за будущее, оно казалось огромным. Пример Павла Дурова подкреплял несбыточные мечты, растущие зарплаты и тусовки подкрепляли перманентную эйфорию. Титан новой цифровой экономики (а мы в это верили, по-настоящему) встречался с титаном нового поколения веб-программирования, который в одной руке держал Python, в другой Javascript, в третьей postgres, а четвертой умело ковырял в носу. На плечах титанов росли стартапы, купоны, бронирования отелей и авиабилетов, блоги и социальные сети, а иногда действительно полезные продукты, типа двача.

**2013-2019**

Хорошего по немножку, получилось так, что тот Интернет умер, старые зведы Интернета стали гаснуть, а компьютерная наука, сложная облась в которую с разбегу, за 2 недели, расправила плечи. Для тех из нас кто в еще в строю, все это, просиживание жёппы за компьютером, эти бессонные ночи, все это теперь не из-за денег или мечты о Кремниевой Долине. Теперь во главе стола стоит интерес, неподдельное любопытство, свет открытий чудных и азарт. Дорога долгая и трудная, но не бросать же свой крест. Эта сентенция лишь о том, что теперь речь не о супер-героях интернета, а о темных владыках Computer Science, о подземных пещерах бетменов, Готем которых заполнен алгоритмами, нейросетями, операционными системами и воспоминаниями о юности, когда на голове еще не было залысин.

**2019**

Суд, через год приговор — двуха. Севера, мошка, крытка, лютые лица.

### Турма Сидел -- Шашка Играл

**2022**

Я вас запутал, ведь это README к шашкам, и вероятно вы спросите, что же дальше. А дальше мы начнем с основ, возьмем Rust, Bevy, PyTorch и несколько алгоритмов вроде Monte-Carlo Tree Search и сделаем шашки. Попробуем реанимировать некоторые знания Computer Science и доказать себе что не все мозги высохли.

Если получится еще и интересное чтиво -- хм, может быть и интерес у читателей появится. Ну ладно. С Богом.

## Rust

Почему Раст? 

Я долго размышлял, и пришел к выводу, что просто потому что люди говорят что Раст крутой. Первым языком у меня был Си, потом я чуть-чуть добавил туда, в голову, Си++, потом понял что это очень сложно, слишком резко и быстро усложнено, и стал искать современные альтернативы. Это было году в 2006, когда я прочитал книги Харви Дейтела "Как Программировать на Си++", выполнил много упражнений оттуда, а книга постоена грамотно, уроке на 5 там уже начинались регистровые машины и написание эмулятора компьютера на Си++. Но вот сам си++, когда начиналось множественное наследование, шаблоны, STL, я этого не выдержал и ушел в Си#. Там не надо было смотреть за памятью, была понятная модель ООП, и хорошая стандартная библиотека. Ладно, про .NET я пока промолчу, но я снова вернулся в Си++ в 2011, когда прошел математическое моделирование, и погрузился глубже в нормальное программирование, с математикой, вычислениями и всем таким.

Теперь когда снова начинается разработка игр, конечно может и стоит снова вернуться к плюсам, и вроде бы за 10 лет многое поменялось, но когда на Расте появляются новые операционные системы, игровые движки с живым сообществом, я не могу отказать себе в удовольствии поднять ржавое. Заржаветь короче.

Итак, что такое Раст? 

### Основые возможности Rust

#### Управление памятью, mutables, ссылки

#### Аннотации

#### Объекты

#### Модули и crates

### Bevy

[Bevy](https://bevyengine.org/) — это относительно простой игровой движок на Rust. Bevy умеет в 3D и 2D, выпускается под лицензией MIT, свободен от роялти платежей. Bevy мультиплатформенный, и может работать в Windows, Linux, браузере в wasm, android, ios и VR.

Выбрав самый горячий пирожок в булочной, наивно полагать что не обожжешься, и первое что надо сделать это разобраться в архитектуре.

#### ECS

Логика приложения в Bevy подчинена паттерну [Entity Component System (ECS)](https://en.wikipedia.org/wiki/Entity_component_system). ECS — это MVC игровой индустрии.

##### Entity

Сущность, объект игрового мира, композиция компонентов. Подобен модели в MVC.

```rust
struct NPC(u64) {
    position: Option<Position>,
    name: String,
}
```

##### Component

Аттрибут entity, например позиция или момент. 

```rust
#[derive(Component)]
struct Position { 
    x: f32, 
    y: f32 
}
```

##### System

Система подобна контроллеру в MVC, отвечает за логику, например за перемещение, коллизии или ИИ. Система оперирует сущностями.

```rust
fn print_position_system(query: Query<&NPC, &Transform>) {
    for (npc, transform) in query.iter() {
        println!("NPC {} at position: {:?}", npc, transform.translation);
    }
}
```

#### Dependency Injection и Plugins

Bevy является модулярным и полагается на паттерн Dependency Injection (DI). DI позволяет внедрять компоненты в приложение, и обращаться к ним благодаря рефлексии или шаблонным функциям.

Плагин в bevy объединяет систему с её сущностями, описывает композицию систем.

```rust
pub struct PiecesPlugin;
impl Plugin for PiecesPlugin {
    fn build(&self, app: &mut App) {
        app.add_startup_system(create_pieces.system())
            .add_system(highlight_piece.system())
            .add_system(move_pieces.system());
    }
}
```

## Шашка 

### Описание правил

### Реализация в Bevy

## Искуственный интеллект

### Python и PyTorch

### Monte Carlo Tree Search и AlphaZero

## Дистрибуция

### Windows

### WEBGL

### Android

## Эпилог
